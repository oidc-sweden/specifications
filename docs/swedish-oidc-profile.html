<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>The Swedish OpenID Connect Profile</title>
    <link type="text/css" rel="stylesheet" href="assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="assets/css/oidc-portrait.css" media="print" >
    <link type="text/css" rel="stylesheet" href="assets/css/oidc-custom.css" media="print" >
  </head>
  <body>
    <article class="markdown-body"><p class="img-container"><img src="img/oidc-logo.png" alt="Logo"></p>
<h1 id="the-swedish-openid-connect-profile">The Swedish OpenID Connect Profile</h1>
<h3 id="version-10---draft-02---2023-05-02">Version: 1.0 - draft 02 - 2023-05-02</h3>
<h2 id="abstract">Abstract</h2>
<p>This specification defines a profile for OpenID Connect for use within the Swedish public and private sector. It profiles the OpenID Connect protocol to get a baseline security and to facilitate interoperability between relying parties and OpenID providers.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol class="list">
<li><p><a href="#introduction"><strong>Introduction</strong></a></p>
<p> 1.1. <a href="#requirements-notation-and-conventions">Requirements Notation and Conventions</a></p>
<p> 1.2. <a href="#conformance">Conformance</a>    </p>
</li>
<li><p><a href="#authentication-requests-and-responses"><strong>Authentication Requests and Responses</strong></a></p>
<p> 2.1. <a href="#authentication-request-parameters">Authentication Request Parameters</a>   </p>
<p> 2.1.1. <a href="#the-scope-parameter">The scope Parameter</a></p>
<p> 2.1.2. <a href="#the-state-parameter">The state Parameter</a></p>
<p> 2.1.3. <a href="#the-redirect-uri-parameter">The redirect_uri Parameter</a></p>
<p> 2.1.4. <a href="#the-prompt-parameter">The prompt Parameter</a></p>
<p> 2.1.5. <a href="#the-login-hint-parameter">The login_hint Parameter</a></p>
<p> 2.1.6. <a href="#the-claims-parameter">The claims Parameter</a></p>
<p> 2.1.7. <a href="#request-objects-request-and-request-uri-parameters">Request Objects (request and request_uri parameters)</a></p>
<p> 2.1.8. <a href="#pkce-parameters">PKCE Parameters</a></p>
<p> 2.2. <a href="#processing-of-authentication-requests">Processing of Authentication Requests</a></p>
<p> 2.3. <a href="#authentication-responses">Authentication Responses</a></p>
</li>
<li><p><a href="#token-endpoint-requests-and-id-token-issuance"><strong>Token Endpoint Requests and ID Token Issuance</strong></a></p>
<p> 3.1. <a href="#token-requests">Token Requests</a></p>
<p> 3.1.1. <a href="#client-authentication">Client Authentication</a></p>
<p> 3.2. <a href="#token-responses-and-validation">Token Responses and Validation</a></p>
<p> 3.2.1. <a href="#id-token-contents">ID Token Contents</a></p>
<p> 3.2.2. <a href="#id-token-validation">ID Token Validation</a></p>
</li>
<li><p><a href="#claims-and-scopes"><strong>Claims and Scopes</strong></a></p>
<p> 4.1. <a href="#userinfo-endpoint">UserInfo Endpoint</a></p>
<p> 4.2. <a href="#claims-release-requirements">Claims Release Requirements</a></p>
</li>
<li><p><a href="#discovery"><strong>Discovery</strong></a></p>
<p> 5.1. <a href="#discovery-requirements-for-a-relying-party">Discovery Requirements for a Relying Party</a></p>
<p> 5.2. <a href="#discovery-requirements-for-an-openid-provider">Discovery Requirements for an OpenID Provider</a></p>
<p> 5.3. <a href="#discovery-parameter-extensions">Discovery Parameter Extensions</a></p>
<p> 5.3.1. <a href="#user-message-capabilities">User Message Capabilities</a></p>
<p> 5.3.2. <a href="#requested-authentication-provider-capabilities">Requested Authentication Authority Capabilities</a></p>
</li>
<li><p><a href="#client-registration"><strong>Client Registration</strong></a></p>
</li>
<li><p><a href="#security-requirements"><strong>Security Requirements</strong></a></p>
<p> 7.1. <a href="#cryptographic-algorithms">Cryptographic Algorithms</a></p>
</li>
<li><p><a href="#normative-references"><strong>Normative References</strong></a></p>
</li>
</ol>
<hr>
<p><a name="introduction"></a></p>
<h2 id="1-introduction">1. Introduction</h2>
<p>This specification defines a profile for OpenID Connect for use within the Swedish public and private sector. It profiles the OpenID Connect protocol to get a baseline security and to facilitate interoperability between relying parties and OpenID providers.</p>
<p>The profile is loosely based on the International Government Assurance Profile for OpenID Connect draft, [<a href="#openid-igov">OpenID.iGov</a>], but since work and progress within the OpenID foundation iGov working group seems to have stopped, the Swedish OpenID Connect working group has decided to produce a stand-alone profile for OpenID Connect.</p>
<blockquote>
<p>Should the work within the OpenID foundation iGov working group be resumed, the Swedish profile will adapt to this work. </p>
</blockquote>
<p><a name="requirements-notation-and-conventions"></a></p>
<h3 id="11-requirements-notation-and-conventions">1.1. Requirements Notation and Conventions</h3>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” are to be interpreted as described in [<a href="#rfc2119">RFC2119</a>].</p>
<p>These keywords are capitalized when used to unambiguously specify requirements over protocol features and behavior that affect the interoperability and security of implementations. When these words are not capitalized, they are meant in their natural-language sense.</p>
<p><a name="conformance"></a></p>
<h3 id="12-conformance">1.2. Conformance</h3>
<p>This profile defines requirements for OpenID Connect Relying Parties (clients) and OpenID Connect Providers (identity providers). Furthermore, it defines the interaction between a Relying Party and an OpenID Provider.</p>
<p>When a component compliant with this profile is interacting with other components compliant with this profile, all components MUST fully conform to the features and requirements of this specification. Any interaction with components that are not compliant with this profile is out of scope for this specification.</p>
<p><a name="authentication-requests-and-responses"></a></p>
<h2 id="2-authentication-requests-and-responses">2. Authentication Requests and Responses</h2>
<p>An OpenID Connect authentication request is a request sent to the Authorization endpoint of an OpenID Provider. These requests MUST be sent using the authorization code flow.</p>
<p>This chapter defines requirements for Relying Parties issuing requests and OpenID Providers processing requests that MUST be followed in order to be compliant with this profile.</p>
<p><a name="authentication-request-parameters"></a></p>
<h3 id="21-authentication-request-parameters">2.1. Authentication Request Parameters</h3>
<p>Section 3.1.2.1 of [<a href="#openid-core">OpenID.Core</a>] defines a set of request parameters for OpenID Connect.  </p>
<p>Below follows a table with request parameters that are mandatory according to this profile along with selected optional parameters for which this profile extends the requirements or descriptions given in [<a href="#openid-core">OpenID.Core</a>].</p>
<blockquote>
<p>In the table below the &quot;Support Requirement&quot; column indicates whether a parameter is required or optional for a
Relying Party to include in a request, and required or optional for an OP to support and process. </p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
<th align="left">Support Requirement</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>client_id</code></td>
<td align="left">The client identifier valid at the OpenID Provider/Authorization Server.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>response_type</code></td>
<td align="left">The response type. MUST be set to <code>code</code>.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>scope</code></td>
<td align="left">Indicates the scopes requested. See <a href="#the-scope-parameter">2.2.1</a> below.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>state</code></td>
<td align="left">Random string generated by the Relying Party. The state is used to protect against CSRF attacks. This value is returned to the Relying Party in the authentication response. See <a href="#the-state-parameter">2.2.2</a> below.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>redirect_uri</code></td>
<td align="left">The endpoint where the Relying Party will receive the authentication response. See <a href="#the-redirect-uri-parameter">2.1.3</a> below.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>nonce</code></td>
<td align="left">String value used to associate a client session with an ID Token, and to mitigate replay attacks. The value is a (unguessable) random string generated by the Relying Party. The nonce value is returned to the Relying Party in the ID Token.</td>
<td align="left">OPTIONAL for RP<br />REQUIRED for OP</td>
</tr>
<tr>
<td align="left"><code>prompt</code></td>
<td align="left">Space delimited, case sensitive list of string values that specifies whether the OpenID Provider prompts the end-user for re-authentication and consent. See <a href="#the-prompt-parameter">2.1.4</a> below.</td>
<td align="left">OPTIONAL for RP<br />REQUIRED for OP</td>
</tr>
<tr>
<td align="left"><code>login_hint</code></td>
<td align="left">Hint to the OpenID Provider about an identifier of the end-user. See <a href="#the-login-hint-parameter">2.1.5</a> below.</td>
<td align="left">OPTIONAL</td>
</tr>
<tr>
<td align="left"><code>claims</code></td>
<td align="left">Parameter for requesting individual claims and specifying parameters that apply to the requested claims. See <a href="the-claims-parameter">2.1.6</a> below.</td>
<td align="left">OPTIONAL for RP<br />REQUIRED for OP</td>
</tr>
<tr>
<td align="left"><code>acr_values</code></td>
<td align="left">Requested Authentication Context Class Reference values.</td>
<td align="left">Optional for RP<br />Mandatory for OP</td>
</tr>
<tr>
<td align="left"><code>request</code></td>
<td align="left">Request Object JWT. See <a href="#request-objects-request-and-request-uri-parameters">2.1.7</a>.</td>
<td align="left">OPTIONAL for RP<br />REQUIRED for OP</td>
</tr>
<tr>
<td align="left"><code>request_uri</code></td>
<td align="left">Request Object JWT passed by reference. See <a href="#request-objects-request-and-request-uri-parameters">2.1.7</a>.</td>
<td align="left">OPTIONAL</td>
</tr>
<tr>
<td align="left"><code>code_challenge</code>, <code>code_challenge_method</code></td>
<td align="left">Proof Key for Code Exchange (PKCE). See <a href="#pkce-parameters">2.1.8</a> below.</td>
<td align="left">OPTIONAL for RP<br />REQUIRED for OP</td>
</tr>
</tbody></table>
<p><a name="the-scope-parameter"></a></p>
<h4 id="211-the-scope-parameter">2.1.1. The scope Parameter</h4>
<p>The <code>scope</code> parameter value MUST contain <code>openid</code> and MAY contain additional scopes controlling required claims.</p>
<p>See [<a href="#attr-spec">OIDC.Sweden.Attr</a>] for all the defined scopes for this profile, and section <a href="#claims-and-scopes">4, Claims and Scopes</a>, for the scopes that are mandatory to support.</p>
<p><a name="the-state-parameter"></a></p>
<h4 id="212-the-state-parameter">2.1.2. The state Parameter</h4>
<p>Relying Parties MUST use an unguessable random value for the <code>state</code> parameter, where the value has at least 128 bits of entropy. </p>
<p>Relying Parties MUST validate the value of the <code>state</code> parameter upon return to the redirect URI and MUST ensure that the value is tied to the current session of the user.</p>
<p>An OpenID Provider MUST include the value of the <code>state</code> parameter in the authentication response.</p>
<p><a name="the-redirect-uri-parameter"></a></p>
<h4 id="213-the-redirect_uri-parameter">2.1.3. The redirect_uri Parameter</h4>
<p>An OpenID Relying Party MUST include the complete redirect URI as a <code>redirect_uri</code> parameter value.</p>
<p>In order to prevent open redirection and other injection attacks, the OpenID Provider MUST match the entire URI using a direct string comparison against registered values and MUST reject requests with an invalid or missing redirect URI.</p>
<p><a name="the-prompt-parameter"></a></p>
<h4 id="214-the-prompt-parameter">2.1.4. The prompt Parameter</h4>
<p>A Relying Party MAY use the <code>prompt</code> parameter to control, or prevent, Single Sign On.</p>
<p>By setting the <code>prompt</code> parameter to <code>none</code> it instructs the OpenID Provider that no display of any authentication or consent views is allowed, and that an error should be returned if the user is not already authenticated at the OpenID Provider. This corresponds to the SAML authentication request attribute <code>IsPassive=true</code>.</p>
<p>By setting the <code>prompt</code> parameter to <code>login</code> the Relying Party instructs the OpenID Provider that the user MUST authenticate, and that it MUST NOT use a previous authentication session for the end-user. This corresponds to the SAML authentication request attribute <code>ForceAuthn=true</code>. </p>
<p>An OpenID Provider MUST support the <code>prompt</code> parameter according to the requirements in section 3.1.2.1 of [<a href="#openid-core">OpenID.Core</a>], with the following extension: If the value of the <code>prompt</code> parameter contains the &quot;login&quot; string value the OpenID Provider MUST prompt the end-user for (re-)authentication.</p>
<p><a name="the-login-hint-parameter"></a></p>
<h4 id="215-the-login_hint-parameter">2.1.5. The login_hint Parameter</h4>
<p>Section 3.1.2.1 of [<a href="#openid-core">OpenID.Core</a>] states that a Relying Party MAY include the <code>login_hint</code> parameter in an authentication request, and that its value is a string that can help the OpenID Provider to select the end-user to
authenticate.</p>
<p>This profile does not define which type of string that is passed as a value to the <code>login_hint</code> parameter. It is 
context- and OpenID Provider specific. </p>
<p>However, a Relying Party MUST NOT use the <code>login_hint</code> to pass a claim value that it requests to be delivered in
the resulting ID token. In these cases the <code>claims</code> request parameter SHOULD be used, see <a href="the-claims-parameter">2.1.6</a>
below.</p>
<p><a name="the-claims-parameter"></a></p>
<h4 id="216-the-claims-parameter">2.1.6. The claims Parameter</h4>
<p>Section 5.5 of [<a href="#openid-core">OpenID.Core</a>] specifies how individual claims can be requested using the <code>claims</code> 
request parameter.</p>
<p>An OpenID Provider compliant with this profile MUST support the <code>claims</code> parameter, both when passed as an OAuth
parameter and when included in a Request Object (see <a href="#request-objects-request-and-request-uri-parameters">2.1.7</a>).</p>
<p>Section <a href="#the-login-hint-parameter">2.1.5</a> states that the <code>claims</code> parameter is to be used
in favour of the <code>login_hint</code> parameter when the Relying Party needs to pass a value that it wants to be
delivered as a claim in the resulting ID token.</p>
<p>The example below illustrates the contents of the <code>claims</code> parameter where the Relying Party specifies 
a value for a specific claim. By doing this instead of specifying the value as a <code>login_hint</code>, the
RP gives the OpenID Provider a more exact view of the user being authenticated.</p>
<pre class="hljs"><code>{
  <span class="hljs-attr">&quot;id_token&quot;</span> : {
    <span class="hljs-attr">&quot;https://id.oidc.se/claim/personalIdentityNumber&quot;</span> : { 
      <span class="hljs-attr">&quot;essential&quot;</span> : <span class="hljs-literal">true</span>, 
      <span class="hljs-attr">&quot;value&quot;</span> : <span class="hljs-string">&quot;191212121212&quot;</span> 
    }
  }
}</code></pre><p><a name="request-objects-request-and-request-uri-parameters"></a></p>
<h4 id="217-request-objects-request-and-request_uri-parameters">2.1.7. Request Objects (request and request_uri parameters)</h4>
<p>An OpenID Provider compliant with this profile MUST support Request Object JWT:s sent by value (using the <code>request</code> parameter) and MAY support Request Object JWT:s sent by reference (using the <code>request_uri</code> parameter).</p>
<p>Request objects MUST be signed by the Relying Party&#39;s registered key, and they MAY be encrypted to the OpenID Provider&#39;s public key.</p>
<p>See chapter 6 of [<a href="#openid-core">OpenID.Core</a>] for further details.</p>
<p><a name="pkce-parameters"></a></p>
<h4 id="218-pkce-parameters">2.1.8. PKCE Parameters</h4>
<p>A Relying Party MAY choose to use the Proof Key for Code Exchange (PKCE) extension, [<a href="#rfc7636">RFC7636</a>] and include the <code>code_challenge</code> and <code>code_challenge_method</code> parameters.</p>
<p>If PKCE is used, the code challenge method <code>S256</code> SHOULD be used.</p>
<p>An OpenID Provider compliant with this profile MUST support the PKCE extension including support for the <code>S256</code> code challenge method.</p>
<p>An OpenID Provider MUST NOT allow a Relying Party to use the <code>plain</code> code challenge method.</p>
<p><a name="processing-of-authentication-requests"></a></p>
<h3 id="22-processing-of-authentication-requests">2.2. Processing of Authentication Requests</h3>
<p>An OpenID Provider compliant with this profile MUST follow the requirements stated in section 3.1.2.2 of [<a href="#openid-core">OpenID.Core</a>] and the requirements put in <a href="#authentication-request-parameters">section 2.1</a> of this profile.</p>
<p>Furthermore, the OpenID Provider MUST not proceed with the authentication if the request contains the <code>acr_values</code> request parameter and none of the specified Requested Authentication Context Class Reference values can be used to authenticate the end-user. In these cases the provider SHOULD respond with an <code>unmet_authentication_requirements</code> error as defined in [<a href="#openid-unmet-authnreq">OpenID.Unmet-AuthnReq</a>].</p>
<p><a name="authentication-responses"></a></p>
<h3 id="23-authentication-responses">2.3. Authentication Responses</h3>
<p>Entities compliant with this profile MUST follow the requirements regarding authentication error
responses put in section 3.1.2.6 of [<a href="#openid-core">OpenID.Core</a>].</p>
<p>OpenID Providers SHOULD limit the use of error codes to the sets defined in:</p>
<ul class="list">
<li><p>Section 4.1.2.1 of [<a href="#oauth2-rfc6749">OAuth2.RFC6749</a>],</p>
</li>
<li><p>section 3.1.2.6 of [<a href="#openid-core">OpenID.Core</a>], and, </p>
</li>
<li><p>[<a href="#openid-unmet-authnreq">OpenID.Unmet-AuthnReq</a>].</p>
</li>
</ul>
<p>The OpenID Connect and OAuth2 specifications do not specify any detailed error codes describing
different types of authentication failures. Therefore, it is the OpenID Provider&#39;s responsibility
to inform the user in detail about why a particular authentication failed. The Relying Party normally
only receives an <code>access_denied</code> error code.</p>
<p>One special case that is not handled by OpenID Connect (or SAML) is when an end user cancels an operation
at the OP. This is a shortcoming, since from the Relying Party&#39;s UX point of view this should often not be
seen as an error. Normally, the user should just be passed back to the application&#39;s login page. 
A typical reason for cancelling a login attempt would be that the user selected the wrong login method
(OP), and needs to get back to the application login page.</p>
<p>Therefore, OpenID Providers compliant with this specification SHOULD handle cancelled authentications
according to the following:</p>
<p>No error view is displayed for the user at the OP. Instead an authentication error response is sent 
back to the Relying Party where the <code>error</code> parameter is set to <code>access_denied</code> and the <code>error_description</code>
parameter begins with the text <code>&quot;user-cancel&quot;</code>.</p>
<p><a name="token-endpoint-requests-and-id-token-issuance"></a></p>
<h2 id="3-token-endpoint-requests-and-id-token-issuance">3. Token Endpoint Requests and ID Token Issuance</h2>
<p>This chapter declares requirements that extend, or clarify, the requirements for ID tokens in section 3.1.3 of [<a href="#openid-core">OpenID.Core</a>].</p>
<p><a name="token-requests"></a></p>
<h3 id="31-token-requests">3.1. Token Requests</h3>
<p>A Token Request MUST be sent in accordance with section 3.1.3.1 of [<a href="#openid-core">OpenID.Core</a>] meaning that the <code>grant_type</code> is set to <code>authorization_code</code> and <code>code</code> carries the value of the code parameter returned in the authentication (authorization) response.</p>
<p>For client authentication requirements, see <a href="#client-authentication">3.1.1</a> below.</p>
<p><a name="client-authentication"></a></p>
<h4 id="311-client-authentication">3.1.1. Client Authentication</h4>
<p>OpenID Providers compliant with this profile MUST support the <code>private_key_jwt</code> method for client authentication at the Token endpoint, and MAY support other methods as specified in section 9 of [<a href="#openid-core">OpenID.Core</a>].</p>
<p>The <code>none</code> authentication method MAY be used in the cases where client authentication is performed by other means, for example by mutual TLS. In these cases the authentication process MUST resolve a registered <code>client_id</code>. Otherwise the <code>none</code> method MUST NOT be accepted or used.</p>
<p>A Relying Party SHOULD default to use the <code>private_key_jwt</code> method, and in these cases the following claims MUST be included in the token request:</p>
<ul class="list">
<li><code>client_assertion_type</code> - Set to <code>urn:ietf:params:oauth:client-assertion-type:jwt-bearer</code></li>
<li><code>client_assertion</code> - The value of the signed client authentication JWT generated. The Relying Party must generate a new assertion JWT for each call to the token endpoint.</li>
</ul>
<p><a name="token-responses-and-validation"></a></p>
<h3 id="32-token-responses-and-validation">3.2. Token Responses and Validation</h3>
<p>The token response MUST include an access token (to be used to make UserInfo requests) and an ID token as described below.</p>
<p><a name="id-token-contents"></a></p>
<h3 id="321-id-token-contents">3.2.1. ID Token Contents</h3>
<p>ID Tokens issued by OpenID Providers compliant with this profile MUST be signed and MAY be encrypted using the appropriate key of the requesting Relying Party.</p>
<p>Section 2 of [<a href="#openid-core">OpenID.Core</a>] defines the contents of an ID Token. Below follows a listing of the token claims that are mandatory according to this profile along with selected optional claims for which this profile extends the requirements or descriptions given in [<a href="#openid-core">OpenID.Core</a>].</p>
<table>
<thead>
<tr>
<th align="left">Token Claim</th>
<th align="left">Description</th>
<th align="left">Requirement</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>iss</code></td>
<td align="left">Issuer of the token.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>sub</code></td>
<td align="left">Subject identifier. See <a href="#the-sub-token-claim">3.2.1.1</a> below.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>aud</code></td>
<td align="left">Audience of the ID Token.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>exp</code></td>
<td align="left">Expiration time. See <a href="#the-exp-token-claim">3.2.1.2</a> below.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>iat</code></td>
<td align="left">Issuance time.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>auth_time</code></td>
<td align="left">Time when the end-user authentication occurred. In the cases where an ID Token is issued based on a previous end-user authentication, this claim MUST hold the time from the original authentication.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>nonce</code></td>
<td align="left">Nonce that must be matched against nonce provided in the authentication request.</td>
<td align="left">OPTIONAL</td>
</tr>
<tr>
<td align="left"><code>acr</code></td>
<td align="left">Authentication Context Class Reference. See <a href="#the-acr-claims">3.2.1.3</a> below.</td>
<td align="left">REQUIRED if <code>acr_values</code> was received in request, otherwise OPTIONAL</td>
</tr>
</tbody></table>
<p>Except for the claims listed above the OpenID Provider also includes claims in the ID token that depends on requested scopes and claims.</p>
<p><a name="the-sub-token-claim"></a></p>
<h4 id="3211-the-sub-token-claim">3.2.1.1. The sub Token Claim</h4>
<p>Section 8 of [<a href="#openid-core">OpenID.Core</a>] defines two Subject Identifier Types, <code>public</code> and <code>pairwise</code>. An OpenID Provider compliant with this profile MUST support the <code>public</code> type and SHOULD support the <code>pairwise</code> type.</p>
<p>In order to avoid privacy violations an OpenID Provider MUST NOT use an end-user attribute that reveals personal information about the end-user as the value for <code>sub</code>, for example a Swedish personal identity number. Even though this information may be available in other token claims, its release should be dependent on requested scopes (or claims) and not be revealed unless requested (and in some cases consented).</p>
<p><a name="the-exp-token-claim"></a></p>
<h4 id="3212-the-exp-token-claim">3.2.1.2. The exp Token Claim</h4>
<p>The lifetime of an ID Token should be kept as short as possible, and MUST NOT exceed 5 minutes. Shorter times are RECOMMENDED when possible.</p>
<p><a name="the-acr-claim"></a></p>
<h4 id="3213-the-acr-claim">3.2.1.3. The acr Claim</h4>
<p>If the authentication request corresponding to the ID Token being issued contained a non empty <code>acr_values</code> parameter, the <code>acr</code> claim MUST be included in the ID Token and its value MUST be one of the values supplied in <code>acr_values</code>.</p>
<p>If the Relying Party has registered default Authentication Context Class Reference values using the <code>default_acr_values</code> Client Metadata parameter (see section <a href="#client-registration">6, Client Registration</a>) and any of those are acceptable for the OpenID provider the <code>acr</code> claim MUST be included in the ID Token and its value MUST be one of the values supplied in <code>default_acr_values</code>. </p>
<p>If no <code>acr_values</code> parameter was received in the authentication request the OpenID Provider MAY include the <code>acr</code> claim.</p>
<p><a name="id-token-validation"></a></p>
<h3 id="322-id-token-validation">3.2.2. ID Token Validation</h3>
<p>Relying Parties MUST follow the requirements in section [3.1.3.7] of [<a href="#openid-core">OpenID.Core</a>].</p>
<p><a name="claims-and-scopes"></a></p>
<h2 id="4-claims-and-scopes">4. Claims and Scopes</h2>
<p>The &quot;Attribute Specification for the Swedish OpenID Connect Profile&quot; document, [<a href="#attr-spec">OIDC.Sweden.Attr</a>], defines
claims and scopes to be used by entities compliant with the Swedish OpenID Connect profile. </p>
<p>Additional claims and scopes may be defined in profiles extending this profile, but to stay compliant and thus ensure
interoperability, a claim that represents an identity value that already has a definition in [<a href="#attr-spec">OIDC.Sweden.Attr</a>]
MUST NOT be re-defined with a new claim name in profiles extending the Swedish OpenID Connect profile.</p>
<blockquote>
<p>As an example: An OpenID Provider compliant with this profile MUST not invent its own claim definition of a Swedish
personal identity number. It MUST use the <code>https://id.oidc.se/claim/personalIdentityNumber</code> defined in 
[<a href="#attr-spec">OIDC.Sweden.Attr</a>].</p>
</blockquote>
<p><a name="userinfo-endpoint"></a></p>
<h3 id="41-userinfo-endpoint">4.1. UserInfo Endpoint</h3>
<p>An OpenID Provider compliant with this profile SHOULD support releasing claims from the UserInfo endpoint. If supported the OpenID Provider MUST follow the requirements from section 5.3 of [<a href="#openid-core">OpenID.Core</a>].</p>
<p>Responses from the UserInfo endpoint MUST be signed.</p>
<p>The OpenID Provider MUST NOT release any user identity claims other than the mandatory <code>sub</code> claim if they are not explicitly requested in the original authentication request via the <code>claims</code> parameter, see <a href="#the-claims-parameter">2.1.6</a>, or by a standard scope (see below).</p>
<p><a name="claims-release-requirements"></a></p>
<h3 id="42-claims-release-requirements">4.2. Claims Release Requirements</h3>
<p>OpenID Providers MUST return claims on a best effort basis. However, an OpenID Provider asserting it can provide a user claim does not imply that this data is available for all its users. Relying Parties MUST be prepared to receive partial data. </p>
<p>An OpenID Provider compliant with this profile MUST NOT release any identity claims<sup>1</sup> in the ID token, or via the UserInfo endpoint, if they have not been explicitly requested via the <code>scope</code> and/or <code>claims</code> request parameters, or by a policy<sup>2</sup> known, and accepted, by the involved parties. </p>
<p>Section 5.4 of [<a href="#openid-core">OpenID.Core</a>] states:</p>
<blockquote>
<p>The Claims requested by the <code>profile</code>, <code>email</code>, <code>address</code>, and <code>phone</code> scope values are returned from the UserInfo Endpoint, as described in Section 5.3.2, when a <code>response_type</code> value is used that results in an Access Token being issued. However, when no Access Token is issued (which is the case for the <code>response_type</code> value <code>id_token</code>), the resulting Claims are returned in the ID Token. </p>
</blockquote>
<p>[<a href="#openid-core">OpenID.Core</a>] basically assumes that the user identity is delivered in the <code>sub</code> claim that is part of the ID token, and all other attributes are complementary attributes that may be fetched in a later call to the UserInfo endpoint. </p>
<p>The Swedish OpenID Connect profile takes another approach regarding the primary user identity, and the primary user identity is most often represented by a claim delivered as part of a requested scope. Therefore, this profile, requires that if any of the scopes defined in section 3 of [<a href="#attr-spec">OIDC.Sweden.Attr</a>] are requested the corresponding claims MUST be delivered in the ID token<sup>3</sup>.</p>
<p>&quot;Authentication Information Claims&quot; as defined in section 2.3 of [<a href="#attr-spec">OIDC.Sweden.Attr</a>] are claims
describing an authentication event, and are not user identity claims. Therefore, any of these claims
MUST be delivered in the ID token and MUST NOT be delivered from the UserInfo endpoint.</p>
<p>Note: In order to be compliant with [<a href="#openid-core">OpenID.Core</a>] it is RECOMMENDED that claims requested by the scope values
<code>profile</code>, <code>email</code>, <code>address</code>, and <code>phone</code> are delivered from the UserInfo endpoint. However, there are some overlap between the
<code>profile</code> scope and the  <code>https://id.oidc.se/scope/naturalPersonName</code> and <code>https://id.oidc.se/scope/naturalPersonNumber</code> scopes,
and a Relying Party SHOULD use the latter scopes instead of the <code>profile</code> scope where applicable. </p>
<blockquote>
<p>[1]: Apart from the mandatory <code>sub</code> claim that also can be seen as an identity attribute. </p>
</blockquote>
<blockquote>
<p>[2]: Such a claims release policy is out of scope for this specification.</p>
</blockquote>
<blockquote>
<p>[3]: Unless a <code>claims</code> parameter has been supplied where delivery via the UserInfo endpoint has been ordered.</p>
</blockquote>
<p><a name="discovery"></a></p>
<h2 id="5-discovery">5. Discovery</h2>
<p><a name="discovery-requirements-for-a-relying-party"></a></p>
<h3 id="51-discovery-requirements-for-a-relying-party">5.1. Discovery Requirements for a Relying Party</h3>
<p>Relying Parties SHOULD cache OpenID Provider metadata after a provider has been discovered and used by the Relying Party.</p>
<p><a name="discovery-requirements-for-an-openid-provider"></a></p>
<h3 id="52-discovery-requirements-for-an-openid-provider">5.2. Discovery Requirements for an OpenID Provider</h3>
<p>OpenID Providers compliant with this profile MUST support the OpenID Connect Discovery standard, [<a href="#openid-discovery">OpenID.Discovery</a>] and adhere to the requirements defined in this chapter.</p>
<p>Access to the Discovery document MAY be protected with existing web authentication methods if required by the OpenID Provider. Further requirements about access management of the Discovery document is outside of the scope for this specification.</p>
<p>The endpoints described in the Discovery document MUST be secured in accordance with this profile.</p>
<p>All OpenID Providers are uniquely identified by a URL known as the issuer. This URL serves as the prefix of a service discovery endpoint as specified in [<a href="#openid-discovery">OpenID.Discovery</a>]. </p>
<p>An OpenID Provider compliant with this profile MUST present a discovery document including the required fields specified in section 3 of [<a href="#openid-discovery">OpenID.Discovery</a>] <strong>and</strong> meet the requirements in the table below: </p>
<table>
<thead>
<tr>
<th align="left">Field</th>
<th align="left">Description</th>
<th align="left">Requirement</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>token_endpoint</code></td>
<td align="left">Fully qualified URL of the OpenID Provider&#39;s OAuth 2.0 Token Endpoint.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>userinfo_endpoint</code></td>
<td align="left">Fully qualified URL of the OpenID Provider&#39;s UserInfo Endpoint.</td>
<td align="left">OPTIONAL</td>
</tr>
<tr>
<td align="left"><code>scopes_supported</code></td>
<td align="left">JSON array containing a list of the scope values that this provider supports. MUST contain the <code>openid</code> value.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>response_types_supported</code></td>
<td align="left">JSON array containing a list of the OAuth 2.0 <code>response_type</code> values that the OpenID Provider supports. MUST contain the <code>code</code> type.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>acr_values_supported</code></td>
<td align="left">JSON array containing a list of the Authentication Context Class References that the OpenID Provider supports.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>subject_types_supported</code></td>
<td align="left">JSON array containing a list of the Subject Identifier types that the OpenID Provider supports. MUST contain <code>public</code> and SHOULD contain <code>pairwise</code></td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>token_endpoint_auth_</code><br /><code>methods_supported</code></td>
<td align="left">JSON array containing a list of client authentication methods supported by at the Token endpoint. MUST contain <code>private_key_jwt</code> and MAY contain other authentication methods as specified in section 9 of [<a href="#openid-core">OpenID.Core</a>].</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>token_endpoint_auth_</code><br /><code>signing_alg_values_supported</code></td>
<td align="left">JSON array containing a list of JWS signing algorithms supported by the Token Endpoint for the signature on the JWT used to authenticate the client at the Token Endpoint for the <code>private_key_jwt</code>. <code>RS256</code> MUST appear, and <code>none</code> MUST NOT appear.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>claims_supported</code></td>
<td align="left">JSON array containing a list of the claim names of the claims that the OpenID Provider MAY be able to supply values for.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>claims_parameter_supported</code></td>
<td align="left">Boolean value specifying whether the OpenID Provider supports use of the <code>claims</code> request parameter. Since this profile requires support the value MUST be set to <code>true</code>.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>request_parameter_supported</code></td>
<td align="left">Boolean value specifying whether the OpenID Provider supports use of the <code>request</code> parameter for Request Objects. Since this profile requires support the value MUST be set to <code>true</code>.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>code_challenge_methods_supported</code></td>
<td align="left">JSON array containing a list of PKCE code challenge methods supported by this OP. The array MUST include the <code>S256</code> method and MUST NOT include the <code>plain</code> method.<br />The <code>code_challenge_methods_supported</code> parameter is defined in section 2 of [<a href="#rfc8614">RFC8614</a>].</td>
<td align="left">REQUIRED</td>
</tr>
</tbody></table>
<p>Any other fields specified in [<a href="#openid-discovery">OpenID.Discovery</a>] not appearing in the table above MAY also be used.</p>
<p><a name="client-registration"></a></p>
<h2 id="6-client-registration">6. Client Registration</h2>
<p>Section 2 of [<a href="#openid-registration">OpenID.Registration</a>] defines a listing of the client metadata used for Client Registration at the OpenID Provider. This chapter adds extra requirements and clarifications for use according to this profile.  </p>
<p>The profile does not mandate OpenID Provider support for Dynamic registration of Relying Parties (clients). However, an OpenID Provider compliant with this profile MUST still be able to handle the client registration parameters specified in this section and in section 2 of [<a href="#openid-registration">OpenID.Registration</a>]. This means that if an OpenID Provider
registers Relying Parties by other means, it MUST gather and maintain all required client information parameters in the
following table.</p>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
<th align="left">Requirement</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>redirect_uris</code></td>
<td align="left">Array of redirection URI values used by the Relying Party.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>response_types</code></td>
<td align="left">The response types that the Relying Party uses. Must be set to <code>code</code>.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>grant_types</code></td>
<td align="left">The OAuth2 grant types the Relying Party uses. Must be set to <code>authorization_code</code>.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>jwks</code></td>
<td align="left">The Relying Party&#39;s JSON Web Key Set [JWK] document, passed by value.</td>
<td align="left">REQUIRED<br />Except for those clients that authenticate according to the exceptions described in section <a href="#client-authentication">3.1.1</a>.</td>
</tr>
<tr>
<td align="left"><code>subject_type</code></td>
<td align="left">Subject type requested for responses to this Client. The <code>subject_types_supported</code> discovery parameter contains a list of the supported <code>subject_type</code> values for this server. Valid types include <code>pairwise</code> and <code>public</code>. The default SHOULD be <code>public</code>. See section <a href="#the-sub-token-claim">3.2.1.1</a>.</td>
<td align="left">OPTIONAL</td>
</tr>
<tr>
<td align="left"><code>token_endpoint_auth_method</code></td>
<td align="left">Authentication method for accessing the Token endpoint. See section <a href="#client-authentication">3.1.1</a>.</td>
<td align="left">REQUIRED</td>
</tr>
<tr>
<td align="left"><code>default_acr_values</code></td>
<td align="left">Default requested Authentication Context Class Reference values.</td>
<td align="left">OPTIONAL</td>
</tr>
</tbody></table>
<p><a name="security-requirements"></a></p>
<h2 id="7-security-requirements">7. Security Requirements</h2>
<p>All transactions MUST be protected in transit by TLS as described in [<a href="#nist800-52">NIST.800-52.Rev2</a>]. </p>
<p>All parties MUST conform to applicable recommendations in section 16, &quot;Security Considerations&quot; of [<a href="#oauth2-rfc6749">OAuth2.RFC6749</a>] and those found in &quot;OAuth 2.0 Threat Model and Security Considerations&quot;, [<a href="#rfc6819">RFC6819</a>].</p>
<p><a name="cryptographic-algorithms"></a></p>
<h3 id="71-cryptographic-algorithms">7.1. Cryptographic Algorithms</h3>
<p>This section lists the requirements for crypto algorithm support for being compliant with this profile.</p>
<p>All entities compliant with this profile MUST follow the guidelines in [<a href="#nist800-131">NIST.800-131A.Rev2</a>]
regarding use of algorithms and key lengths<sup>1</sup>. Specifically, for signature and encryption keys the
following requirements apply:</p>
<ul class="list">
<li>RSA public keys MUST be at least 2048 bits in length.</li>
<li>EC public keys MUST be at least 256 bits in length (signature only). The curve NIST Curve P-256 MUST be 
supported ([<a href="#rfc5480">RFC5480</a>]), and NIST Curve P-384 and NIST Curve P-521 SHOULD be supported.</li>
</ul>
<p>Entities conforming to this profile MUST support algorithms according to &quot;JSON Web Algorithms (JWA)&quot;, 
[<a href="#rfc7518">RFC7518</a>], with the following additions:</p>
<ul class="list">
<li><p><code>RS256</code>, RSASSA-PKCS1-v1_5 using SHA-256, is listed as recommended in [<a href="#rfc7518">RFC7518</a>], but is
REQUIRED to support by this profile.</p>
</li>
<li><p><code>RS384</code>, RSASSA-PKCS1-v1_5 using SHA-384, is listed as optional in [<a href="#rfc7518">RFC7518</a>],
but is RECOMMENDED to support by this profile.</p>
</li>
<li><p><code>RS512</code>, RSASSA-PKCS1-v1_5 using SHA-512, is listed as optional in [<a href="#rfc7518">RFC7518</a>],
but is RECOMMENDED to support by this profile.</p>
</li>
<li><p><code>ES256</code>, ECDSA using P-256 and SHA-256, is listed as recommended in [<a href="#rfc7518">RFC7518</a>], but
is REQUIRED to support by this profile.</p>
</li>
<li><p><code>ES384</code>, ECDSA using P-384 and SHA-384, is listed as optional in [<a href="#rfc7518">RFC7518</a>], but is 
RECOMMENDED to support by this profile.</p>
</li>
<li><p><code>ES512</code>, ECDSA using P-521 and SHA-512, is listed as optional in [<a href="#rfc7518">RFC7518</a>], but is
RECOMMENDED to support by this profile.</p>
</li>
<li><p><code>RSA-OAEP</code>, RSAES OAEP using default parameters, is listed as recommended in [<a href="#rfc7518">RFC7518</a>],
but is REQUIRED to support by this profile.</p>
</li>
<li><p><code>A128GCM</code> and <code>A256GCM</code>, AES GCM using 128/256-bit key, are listed as recommended in [<a href="#rfc7518">RFC7518</a>],
but are REQUIRED by this profile.</p>
</li>
</ul>
<p>The sender of a secure message MUST NOT use an algorithm that is not set as REQUIRED in [<a href="#rfc7518">RFC7518</a>]
or in the listing above, unless it is explicitly declared by the peer in its metadata (Discovery document
or Client Registration metadata).</p>
<blockquote>
<p>[1]: [<a href="#nist800-131">NIST.800-131A.Rev2</a>] contains a listing of algorithms that must not be used.
However, there is a need to explicitly point out that the commonly used algorithm SHA-1 for digests is 
considered broken and MUST NOT be used or accepted.</p>
</blockquote>
<p><a name="normative-references"></a></p>
<h2 id="8-normative-references">8. Normative References</h2>
<p><a name="rfc2119"></a>
<strong>[RFC2119]</strong></p>
<blockquote>
<p><a href="https://www.ietf.org/rfc/rfc2119.txt">Bradner, S., Key words for use in RFCs to Indicate Requirement Levels, March 1997</a>.</p>
</blockquote>
<p><a name="oauth2-rfc6749"></a>
<strong>[OAuth2.RFC6749]</strong></p>
<blockquote>
<p><a href="https://tools.ietf.org/html/rfc6749">Hardt, D., &quot;The OAuth 2.0 Authorization Framework&quot;, RFC 6749, DOI 10.17487/RFC6749, October 2012</a>.</p>
</blockquote>
<p><a name="openid-core"></a>
<strong>[OpenID.Core]</strong></p>
<blockquote>
<p><a href="https://openid.net/specs/openid-connect-core-1_0.html">Sakimura, N., Bradley, J., Jones, M., de Medeiros, B. and C. Mortimore, &quot;OpenID Connect Core 1.0&quot;, August 2015</a>.</p>
</blockquote>
<p><a name="openid-unmet-authnreq"></a>
<strong>[OpenID.Unmet-AuthnReq]</strong></p>
<blockquote>
<p><a href="https://openid.net/specs/openid-connect-unmet-authentication-requirements-1_0.html">T. Lodderstedt, &quot;OpenID Connect Core Error Code unmet_authentication_requirements&quot;</a>.</p>
</blockquote>
<p><a name="openid-discovery"></a>
<strong>[OpenID.Discovery]</strong></p>
<blockquote>
<p><a href="https://openid.net/specs/openid-connect-discovery-1_0.html">Sakimura, N., Bradley, J., Jones, M. and E. Jay, &quot;OpenID Connect Discovery 1.0&quot;, August 2015</a>.</p>
</blockquote>
<p><a name="openid-registration"></a>
<strong>[OpenID.Registration]</strong></p>
<blockquote>
<p><a href="https://openid.net/specs/openid-connect-registration-1_0.html">Sakimura, N., Bradley, J., and M. Jones, “OpenID Connect Dynamic Client Registration 1.0,” November 2014</a>.</p>
</blockquote>
<p><a name="openid-igov"></a>
<strong>[OpenID.iGov]</strong></p>
<blockquote>
<p><a href="https://openid.net/specs/openid-igov-openid-connect-1_0.html">M. Varley, P. Grassi, &quot;International Government Assurance Profile (iGov) for OpenID Connect 1.0&quot;, October 05, 2018</a>.</p>
</blockquote>
<p><a name="rfc7515"></a>
<strong>[RFC7515]</strong></p>
<blockquote>
<p><a href="https://tools.ietf.org/html/rfc7515">Jones, M., Bradley, J., and N. Sakimura, “JSON Web Token (JWT)”, May 2015</a>.</p>
</blockquote>
<p><a name="rfc8614"></a>
<strong>[RFC8614]</strong></p>
<blockquote>
<p><a href="https://www.rfc-editor.org/rfc/rfc8414.html">Jones, M., Bradley, J., and N. Sakimura, &quot;OAuth 2.0 Authorization Server Metadata&quot;, June 2018</a>.</p>
</blockquote>
<p><a name="rfc6819"></a>
<strong>[RFC6819]</strong></p>
<blockquote>
<p><a href="https://tools.ietf.org/html/rfc6819">Lodderstedt, T., McGloin, M. and P. Hunt, &quot;OAuth 2.0 Threat Model and Security Considerations&quot;, RFC 6819, January 2013</a>.</p>
</blockquote>
<p><a name="rfc8417"></a>
<strong>[RFC8417]</strong></p>
<blockquote>
<p><a href="https://tools.ietf.org/html/rfc8417">P. Hunt, M. Jones, W. Denniss, M. Ansari, &quot;Security Event Token (SET)&quot;, July 2018</a>.</p>
</blockquote>
<p><a name="rfc7636"></a>
<strong>[RFC7636]</strong></p>
<blockquote>
<p><a href="https://tools.ietf.org/html/rfc7636">Sakimura, N., Bradley, J. and N. Agarwal, &quot;Proof Key for Code Exchange by OAuth Public Clients&quot;, RFC 7636, DOI 10.17487/RFC7636, September 2015</a>.</p>
</blockquote>
<p><a name="rfc5480"></a>
<strong>[RFC5480]</strong></p>
<blockquote>
<p><a href="https://www.ietf.org/rfc/rfc5480.txt">IETF RFC 5480, Elliptic Curve Cryptography Subject Public Key Information, March 2009</a>.</p>
</blockquote>
<p><a name="rfc7518"></a>
<strong>[RFC7518]</strong></p>
<blockquote>
<p><a href="https://www.rfc-editor.org/rfc/rfc7518.txt">Jones, M., &quot;JSON Web Algorithms (JWA)&quot;, May 2015</a>.</p>
</blockquote>
<p><a name="attr-spec"></a>
<strong>[OIDC.Sweden.Attr]</strong></p>
<blockquote>
<p><a href="https://oidc.se/specifications/swedish-oidc-attribute-specification.html">Attribute Specification for the Swedish OpenID Connect Profile</a>.</p>
</blockquote>
<p><a name="nist800-52"></a>
<strong>[NIST.800-52.Rev2]</strong></p>
<blockquote>
<p><a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-52r2.pdf">NIST Special Publication 800-52, Revision 2, &quot;Guidelines for the Selection, Configuration, and Use of Transport Layer Security (TLS) Implementations&quot;</a>. </p>
</blockquote>
    </article>
  </body>
</html>
